"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeStorage=void 0;function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var configureStorage=function(){return function(a){if("object"!==_typeof(a))throw new Error("options must be an object");if("string"!=typeof a.storage_dir||""===a.storage_dir)throw new Error("storage_dir must be set");return FS_API(a).create_dir(a.storage_dir),a}},makeStorage=function(a){return function(b){var c=configureStorage(b);return filenamer=filenamer(c),{setItem:setItem(a.write)(filenamer),getItem:getItem(a.read)(filenamer),removeItem:removeItem(a.remove)(filenamer),getAllKeys:getAllKeys(a.read)(filenamer)}}};exports.makeStorage=makeStorage;var setItem=function(a){return function(b){return function(c,d){return console.log("setItem",c,_typeof(d)),new Promise(function(e,f){try{a(b(c),d,"utf8"),e()}catch(a){f(a)}})}}},getItem=function(a){return function(b){return function(c){return new Promise(function(d,e){try{var f=a(b(c),"utf8");d(f)}catch(a){e(a)}})}}},removeItem=function(a){return function(b){return function(c){return new Promise(function(d,e){try{return a(b(c))}catch(a){e(a)}})}}},getAllKeys=function(a){return function(b){return function(){return new Promise(function(c,d){try{var e=a(b(key),"utf8");c(object.keys(JSON.parse(e)))}catch(a){d(a)}})}}};